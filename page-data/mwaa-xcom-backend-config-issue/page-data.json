{"componentChunkName":"component---src-templates-post-jsx","path":"/mwaa-xcom-backend-config-issue/","result":{"data":{"site":{"siteMetadata":{"title":"dev0wner's Engineering Blog"}},"markdownRemark":{"id":"4c1ab40d-5821-5c2b-aff0-eb6e84d6617b","excerpt":"ë¬¸ì œ AWS MWAA ì— custom xcom backendë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´  ì ìš© ì‹œ\ní´ëŸ¬ìŠ¤í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ í•´ê²° 1. airflow.cfg ì˜µì…˜ ë³€ê²½ ì‹¤íŒ¨ì— ëŒ€í•œ ë””ë²„ê¹… ì´ìŠˆ ì¬í˜„ localì— mwaa í™˜ê²½ êµ¬ì¶• í›„  ì ìš©ì‹œ í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸   í™•ì¸ MWAAì—ì„œëŠ” Config ì‹¤íŒ¨ë¡œ ì¸í•œ retry ë“±ìœ¼ë¡œ API Timeoutì´ ë‚  ë•Œ ê¹Œì§€ ì˜¤ëœ â€¦","html":"<h2>ë¬¸ì œ</h2>\n<ul>\n<li>AWS MWAA <code class=\"language-text\">airflow.cfg</code>ì— custom xcom backendë¥¼ ë“±ë¡í•˜ê¸° ìœ„í•´ <code class=\"language-text\">core.xcom_backend:include.s3_xcom_backend.S3XComBackend</code> ì ìš© ì‹œ\ní´ëŸ¬ìŠ¤í„° ì—…ë°ì´íŠ¸ ì‹¤íŒ¨</li>\n</ul>\n<h2>í•´ê²°</h2>\n<h3>1. airflow.cfg ì˜µì…˜ ë³€ê²½ ì‹¤íŒ¨ì— ëŒ€í•œ ë””ë²„ê¹…</h3>\n<ol>\n<li>\n<p>ì´ìŠˆ ì¬í˜„</p>\n<ul>\n<li>\n<p>localì— mwaa í™˜ê²½ êµ¬ì¶• í›„ <code class=\"language-text\">core.xcom_backend:include.s3_xcom_backend.S3XComBackend</code> ì ìš©ì‹œ í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/91773868639b32eddb0544cd10f8efe6/cc39a/2022-11-25-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 11.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYklEQVR42jWOSwoAIQxDZdyI3xkR//e/ZsYUXIS8tIFW5TERSoE2Bo/WcM7Bey8KISDGKEy/zDlFZt9aKzuyenvHtxZczlLIx+ecaK2h1ooxhuR+esycUzfvvVHOQyklOfIDkqYvwPRIONAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 1' title='2022 11 25 1' src='/static/91773868639b32eddb0544cd10f8efe6/ca1dc/2022-11-25-1.png' srcset='/static/91773868639b32eddb0544cd10f8efe6/e7570/2022-11-25-1.png 170w,\n/static/91773868639b32eddb0544cd10f8efe6/f46e7/2022-11-25-1.png 340w,\n/static/91773868639b32eddb0544cd10f8efe6/ca1dc/2022-11-25-1.png 680w,\n/static/91773868639b32eddb0544cd10f8efe6/02d09/2022-11-25-1.png 1020w,\n/static/91773868639b32eddb0544cd10f8efe6/9d567/2022-11-25-1.png 1360w,\n/static/91773868639b32eddb0544cd10f8efe6/cc39a/2022-11-25-1.png 1694w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n</li>\n<li><code class=\"language-text\">AirflowConfigException: The object could not be loaded</code> í™•ì¸</li>\n<li>MWAAì—ì„œëŠ” Config ì‹¤íŒ¨ë¡œ ì¸í•œ retry ë“±ìœ¼ë¡œ API Timeoutì´ ë‚  ë•Œ ê¹Œì§€ ì˜¤ëœ ì‹œê°„ Cluster ìƒíƒœê°€ <code class=\"language-text\">Updating</code>ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n</ul>\n</li>\n<li>\n<p>ê¸°ë³¸ ê°’ ì ìš©ì‹œ ë‚´ìš© í™•ì¸</p>\n<ul>\n<li>\n<p><code class=\"language-text\">\"core.xcom_backend\": \"airflow.models.xcom.BaseXCom\"</code></p>\n<p>â†’ ì„±ê³µ</p>\n<p>â†’ Valueê°’ì— ì°¸ì¡°í•  ìˆ˜ ì—†ëŠ” ê°’ì´ ë“¤ì–´ê°€ë©´ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì„ ìœ ì¶”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code class=\"language-text\">dags/</code> í´ë”ì— <code class=\"language-text\">s3_xcom_backend.py</code> íŒŒì¼ ìƒì„± í›„ configuration ì ìš©</p>\n<ul>\n<li><code class=\"language-text\">\"core.xcom_backend\": \"s3_xcom_backend.S3XComBackend\"</code></li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/da1565b98e649d621da24c378012c31d/2561a/2022-11-25-2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 14.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVR42l2NSQ7EIAwE+f8zcaSQUVgOEHZ6cDKHIZbqYpe7BdEGRhJBSsLxORFTRkppIeeMXJ59fN3+EfuuoNQBYy289wjXNZ/LE/CjlIIQAoyxiDGitYZa6yxYPUawxLDAM8ZA732Bdxyktb5dO8udc3fw2/0Cy+LonauzsgUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 2' title='2022 11 25 2' src='/static/da1565b98e649d621da24c378012c31d/ca1dc/2022-11-25-2.png' srcset='/static/da1565b98e649d621da24c378012c31d/e7570/2022-11-25-2.png 170w,\n/static/da1565b98e649d621da24c378012c31d/f46e7/2022-11-25-2.png 340w,\n/static/da1565b98e649d621da24c378012c31d/ca1dc/2022-11-25-2.png 680w,\n/static/da1565b98e649d621da24c378012c31d/02d09/2022-11-25-2.png 1020w,\n/static/da1565b98e649d621da24c378012c31d/2561a/2022-11-25-2.png 1180w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>â†’ <strong>ì„±ê³µ</strong></p>\n</li>\n</ol>\n<h3>2. MWAA Managed Node ì ‘ê·¼ ë°©ë²•ì´ ìˆì„ê¹Œ?</h3>\n<ul>\n<li>Managed serviceì´ê³  ë‚´ë¶€ì ìœ¼ë¡œ <code class=\"language-text\">Amazon ECS on Fargate</code>ë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— airflowê°€ ì„¤ì¹˜ëœ hostì˜ shellë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ í˜„ì¬ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>\n<li>\n<p>MWAA Architecture</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/40f9830c01782fdc7a0a6c676e49bb3c/adb12/2022-11-25-3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 57.64705882352942%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACZ0lEQVR42o1TW0/UQBTe3+lvMD7xjCQkGh/0TaPRGIwRgi9AImI0IhgQNgoE3AvZbunulr223d5me5tpP89MFx+MJjY5yWnnnDPnu7RiOS6mXoCJM8VVr4+x7ah8MLZU7voB/vcpigKV80YTtUsNumHioqGhpXfRandQv2yr0DsmeJYh5znSJEYSR+BpRsEhuECeccSdEQSL1dDKqXEIn3mU5jf3/HkvMpGq7GfvBLplzr8L8DxDFidoLr1EWDPKgbI0aFXRe30bg637sHefIC/K8aMvKxhu3oUfzWA7KVhE2/VP0KjbeL5qYZZwNURuKzdVA2VjbF3DPdvBsLqN7vE24kyow+DqAn59D24YYKxPELoBXO0bDg4MLD9swgsiFCwkOgSKvERYEZQk4RSOVv0NMgtsWLVdWO0TRMNLIlvg+tEDzGrnJQl5uU3ikZDLS+CmORclR0UmXvMQ7ce3kAYTSAo87Qc6r+6gu76I4cYibN9F66gBZzKFNTQxWFuA3TqCQxten2lwRhY4n0OO4wwiTZF6DkIq8NkMgRuCswAiZmC2D8dhCGcCEXFljYfQ3j3FSL8Ao/cwzMFYBEFOUAPHI4ZUCMRxDneSKrUtK0ZEPKYU/X6MqRMq7TlBElQrdxHkOcGz0h2kYiHmHBrPNsG+1tH1DLx4f4+OC5grO5h+OqWGEP03C8o6g7V12JsbqiknRDlBlGLcRCGHyoH65yoJYMAY97Cx/xYsS9D6eAzze4NgBqh9WIVHSl7t7aNzcFi6tSj+4tb5n3LzkhEfsjojLiTwVBqabk7kGXlMwuRK4Vw1/it+ARIjhsZ+t3OJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 3' title='2022 11 25 3' src='/static/40f9830c01782fdc7a0a6c676e49bb3c/ca1dc/2022-11-25-3.png' srcset='/static/40f9830c01782fdc7a0a6c676e49bb3c/e7570/2022-11-25-3.png 170w,\n/static/40f9830c01782fdc7a0a6c676e49bb3c/f46e7/2022-11-25-3.png 340w,\n/static/40f9830c01782fdc7a0a6c676e49bb3c/ca1dc/2022-11-25-3.png 680w,\n/static/40f9830c01782fdc7a0a6c676e49bb3c/adb12/2022-11-25-3.png 970w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n</li>\n</ul>\n<h3>3. Airflow Configuration ë³€ê²½ ë°©ë²•</h3>\n<ul>\n<li>í˜„ì¬ MWAAì—ì„œëŠ” airflow.cfgë¥¼ <strong>ì§ì ‘ì </strong>ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>\n<li>\n<p>ê°€ëŠ¥í•œ ë°©ë²•ì€ ì•„ë˜ 3ê°€ì§€ ì…ë‹ˆë‹¤.</p>\n<ol>\n<li>\n<p><code class=\"language-text\">CFN</code>ì´ë‚˜ <code class=\"language-text\">CDK</code>ë“± <code class=\"language-text\">IaC</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒì„±í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ í•  ë•Œ ì˜µì…˜ ë°˜ì˜</p>\n<ul>\n<li><code class=\"language-text\">AirflowConfigurationOptions</code></li>\n</ul>\n</li>\n<li>WEB UIë¥¼ í†µí•œ ë°©ë²•</li>\n</ol>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/3da0fafcf2733f560f8cc20d16daa2c4/18baa/2022-11-25-4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 32.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1klEQVR42oWP4Q6CMAyEef/XU8AoGvCPwDYYxA0Hg7NdRI2JuuTLuqa9u0XGGGy2MY7HE+I4QZKk2B8ypOkORXFGlmU45QWUvmIYBljL2EdtYekeHkzeI+Jmnp9xKUsIKVFVNaRSEEKGN6NUA617NE2LttVPeE7rLvT7vodnwWmagqtzDjdiHEc4gvvcW9O40WFZlq/42b8EFTmUlCxQ1qhqEWrddcGMBdno12HReZ4R8SAvCqlIuEFNX5X0RUlvY2wYWoc5wTc4WEi4Lqwu7+efyCe8fwdroM/7uFSrBgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 4' title='2022 11 25 4' src='/static/3da0fafcf2733f560f8cc20d16daa2c4/ca1dc/2022-11-25-4.png' srcset='/static/3da0fafcf2733f560f8cc20d16daa2c4/e7570/2022-11-25-4.png 170w,\n/static/3da0fafcf2733f560f8cc20d16daa2c4/f46e7/2022-11-25-4.png 340w,\n/static/3da0fafcf2733f560f8cc20d16daa2c4/ca1dc/2022-11-25-4.png 680w,\n/static/3da0fafcf2733f560f8cc20d16daa2c4/18baa/2022-11-25-4.png 785w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<ol start=\"3\">\n<li>AWS-CLIë¥¼ í†µí•œ ë°©ë²•</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token comment\"># update configuration</span>\naws mwaa update-environment <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> xcom_backend_test <span class=\"token punctuation\">\\</span>\n--airflow-configuration-options <span class=\"token string\">\"\"</span>\"<span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">\\</span>\"scheduler.dag_dir_list_interval<span class=\"token punctuation\">\\</span>\": <span class=\"token punctuation\">\\</span>\"5<span class=\"token punctuation\">\\</span>\",\n  <span class=\"token punctuation\">\\</span>\"scheduler.min_file_process_interval<span class=\"token punctuation\">\\</span>\": <span class=\"token punctuation\">\\</span>\"5<span class=\"token punctuation\">\\</span>\",\n  <span class=\"token punctuation\">\\</span>\"webserver.expose_config<span class=\"token punctuation\">\\</span>\": <span class=\"token punctuation\">\\</span>\"True<span class=\"token punctuation\">\\</span>\"\n  <span class=\"token punctuation\">}</span><span class=\"token string\">\"\"</span>\"</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token comment\"># check configuration</span>\naws mwaa get-environment <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--name</span> xcom_backend_test <span class=\"token operator\">|</span> <span class=\"token punctuation\">\\</span>\njq <span class=\"token parameter variable\">-r</span> <span class=\"token string\">'.Environment.AirflowConfigurationOptions'</span></code></pre></div>\n</li>\n</ul>\n<h3>4. AWS-MWAA-LOCAL-RUNNER</h3>\n<ul>\n<li>\n<p>MWAA í™˜ê²½ì— ì§ì ‘ì ì¸ ì ‘ê·¼ì€ ì–´ë µì§€ë§Œ, <a href=\"https://github.com/aws/aws-mwaa-local-runner\">aws-mwaa-local-runner</a>ë¥¼ í†µí•´ localì— MWAAë¥¼\nmockingí•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token number\">1</span>. /aws-mwaa-local-runner/docker/config/airflow.cfg ë³€ê²½\n<span class=\"token number\">2</span>. ./mwaa-local-env build-image\n<span class=\"token number\">3</span>. ./mwaa-local-env start\n<span class=\"token number\">4</span>. airflow.cfg ë°˜ì˜ í™•ì¸</code></pre></div>\n</li>\n</ul>\n<h3>5. í˜„ì¬ MWAAì— ì ìš©ëœ airflow.cfg ê°’ ë° í™˜ê²½ë³€ìˆ˜ í™•ì¸ ë°©ë²•</h3>\n<ul>\n<li>ì—¬ê¸°ì—ëŠ” ëª‡ê°€ì§€ ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li>í™˜ê²½ë³€ìˆ˜ì—ì„œ í™•ì¸</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> __future__ <span class=\"token keyword\">import</span> annotations\n\n<span class=\"token keyword\">import</span> logging\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime<span class=\"token punctuation\">,</span> timedelta\n\n<span class=\"token keyword\">from</span> airflow <span class=\"token keyword\">import</span> DAG\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>python <span class=\"token keyword\">import</span> PythonOperator\n\nlogger <span class=\"token operator\">=</span> logging<span class=\"token punctuation\">.</span>getLogger<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> DAG<span class=\"token punctuation\">(</span>\n<span class=\"token string\">'get_env_var'</span><span class=\"token punctuation\">,</span>\ndefault_args<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'depends_on_past'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retries'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retry_delay'</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">'check mwaa configuration'</span><span class=\"token punctuation\">,</span>\n  start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2022</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  catchup<span class=\"token operator\">=</span><span class=\"token boolean\">False</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dag<span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">print_env_vars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  keys <span class=\"token operator\">=</span> <span class=\"token builtin\">dict</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">for</span> k<span class=\"token punctuation\">,</span> v <span class=\"token keyword\">in</span> keys<span class=\"token punctuation\">.</span>items<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>k<span class=\"token punctuation\">}</span></span><span class=\"token string\">: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>v<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n\nget_env_vars_operator <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\ntask_id<span class=\"token operator\">=</span><span class=\"token string\">'get_env_vars_task'</span><span class=\"token punctuation\">,</span>\npython_callable<span class=\"token operator\">=</span>print_env_vars\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"2\">\n<li>airflow.cfg íŒŒì¼ì—ì„œ í™•ì¸</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> __future__ <span class=\"token keyword\">import</span> annotations\n\n<span class=\"token keyword\">import</span> logging\n<span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime<span class=\"token punctuation\">,</span> timedelta\n\n<span class=\"token keyword\">from</span> airflow <span class=\"token keyword\">import</span> DAG\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>python <span class=\"token keyword\">import</span> PythonOperator\n\nlogger <span class=\"token operator\">=</span> logging<span class=\"token punctuation\">.</span>getLogger<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> DAG<span class=\"token punctuation\">(</span>\n<span class=\"token string\">'get_airflow_cfg_file'</span><span class=\"token punctuation\">,</span>\ndefault_args<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'depends_on_past'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retries'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retry_delay'</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">'check mwaa configuration'</span><span class=\"token punctuation\">,</span>\n  start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2022</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  catchup<span class=\"token operator\">=</span><span class=\"token boolean\">False</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dag<span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">print_airflow_cfg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>os<span class=\"token punctuation\">.</span>getenv<span class=\"token punctuation\">(</span><span class=\"token string\">'AIRFLOW_HOME'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">/airflow.cfg\"</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> airflow_cfg<span class=\"token punctuation\">:</span>\n  file_contents <span class=\"token operator\">=</span> airflow_cfg<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'\\n</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>file_contents<span class=\"token punctuation\">}</span></span><span class=\"token string\">'</span></span><span class=\"token punctuation\">)</span>\n\nget_airflow_cfg_operator <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\ntask_id<span class=\"token operator\">=</span><span class=\"token string\">'get_airflow_cfg_task'</span><span class=\"token punctuation\">,</span>\npython_callable<span class=\"token operator\">=</span>print_airflow_cfg\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"3\">\n<li>airflow.configuration.conf í™•ì¸</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> __future__ <span class=\"token keyword\">import</span> annotations\n\n<span class=\"token keyword\">import</span> logging\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime<span class=\"token punctuation\">,</span> timedelta\n\n<span class=\"token keyword\">from</span> airflow <span class=\"token keyword\">import</span> DAG\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>configuration <span class=\"token keyword\">import</span> conf\n<span class=\"token keyword\">from</span> airflow<span class=\"token punctuation\">.</span>operators<span class=\"token punctuation\">.</span>python <span class=\"token keyword\">import</span> PythonOperator\n\nlogger <span class=\"token operator\">=</span> logging<span class=\"token punctuation\">.</span>getLogger<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">with</span> DAG<span class=\"token punctuation\">(</span>\n<span class=\"token string\">'get_airflow_cfg'</span><span class=\"token punctuation\">,</span>\ndefault_args<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">'depends_on_past'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retries'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">'retry_delay'</span><span class=\"token punctuation\">:</span> timedelta<span class=\"token punctuation\">(</span>minutes<span class=\"token operator\">=</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  description<span class=\"token operator\">=</span><span class=\"token string\">'check mwaa configuration'</span><span class=\"token punctuation\">,</span>\n  start_date<span class=\"token operator\">=</span>datetime<span class=\"token punctuation\">(</span><span class=\"token number\">2022</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span> <span class=\"token number\">26</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  catchup<span class=\"token operator\">=</span><span class=\"token boolean\">False</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> dag<span class=\"token punctuation\">:</span>\n  <span class=\"token keyword\">def</span> <span class=\"token function\">get_conf_vars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n  logging<span class=\"token punctuation\">.</span>info<span class=\"token punctuation\">(</span>\n  <span class=\"token string-interpolation\"><span class=\"token string\">f\"AIRFLOW__CORE__XCOM_BACKEND: </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>conf<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>section<span class=\"token operator\">=</span><span class=\"token string\">'CORE'</span><span class=\"token punctuation\">,</span> key<span class=\"token operator\">=</span><span class=\"token string\">'XCOM_BACKEND'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token string\">\"</span></span>\n  <span class=\"token punctuation\">)</span>\n\nget_conf_vars_operator <span class=\"token operator\">=</span> PythonOperator<span class=\"token punctuation\">(</span>\ntask_id<span class=\"token operator\">=</span><span class=\"token string\">'get_conf_vars_task'</span><span class=\"token punctuation\">,</span>\npython_callable<span class=\"token operator\">=</span>get_conf_vars\n<span class=\"token punctuation\">)</span></code></pre></div>\n<ol start=\"4\">\n<li>MWAA Web UIì—ì„œ í™•ì¸</li>\n<li>ì§„í–‰ ê³¼ì • ìš”ì•½</li>\n<li>\"webserver.expose_config\": \"Trueâ€ ê°’ì„ ë¨¼ì € ì„¤ì •í•©ë‹ˆë‹¤.</li>\n</ol>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/6fd48288d918c49f49551ce87f38762f/98b00/2022-11-25-5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 21.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAk0lEQVR42o3MwQ6CMBAE0P7/p3kyeiCaCEEsUARKItDutmWsjXfY5GU2cxihlEJVVSjLJ6SUqJsG82LATCA6xloLY0z6hZ4mtKpDPwxY/yUxg13E+5xzmOcFo57SsNCjhmoV+u6dUCwRNmzeR2FfCHBxOMT8ndCnK4bLDf05wyfLQY8XXFEfk0v4mOu9hM0KeGJ8AW/gM4uRJIJSAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 5' title='2022 11 25 5' src='/static/6fd48288d918c49f49551ce87f38762f/ca1dc/2022-11-25-5.png' srcset='/static/6fd48288d918c49f49551ce87f38762f/e7570/2022-11-25-5.png 170w,\n/static/6fd48288d918c49f49551ce87f38762f/f46e7/2022-11-25-5.png 340w,\n/static/6fd48288d918c49f49551ce87f38762f/ca1dc/2022-11-25-5.png 680w,\n/static/6fd48288d918c49f49551ce87f38762f/02d09/2022-11-25-5.png 1020w,\n/static/6fd48288d918c49f49551ce87f38762f/98b00/2022-11-25-5.png 1202w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<ul>\n<li>MWAA Web UI â†’ Admin â†’ Configurationì— ë“¤ì–´ê°‘ë‹ˆë‹¤.</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABPUlEQVR42jVRy07DMBDM/38IEhIXJLhw4QIHECCkSoBCKwKlaeMmtuM6qd/D2hWWNh7v7own6+r7q8X96zP4OGLSGiFGMMZgrcVIuWEYkFKClBKc84IF7SOdg/fgVPfOI69cq7ZywlvX4DjPMMYgkqAQouAsmAnBh5N43yMg4XCcMVtDCBj1gXJAJLEQAio9k3qIxdFMokop2id4uj2LpxThnCuikYi2F+CLGs3DC1TdILY9zGoNozR8FnxaWehpwkTBWIe6rrFcLknQFZf/YSnycu8N1hc3WJxfYXF2ie72Eer6Dp7xUq9iDEQO5WBddpUKPhoHl10Vl6n0eMLeWIifDX4/PiHWLYJQCKMuc8y/XUk1YbsXhbzrJdqOE/boqXFH+T0nAo0k97CBZkpkeaAaPZxPp8vzN+t0xP8Dcy7Lfc+jU/wAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 6' title='2022 11 25 6' src='/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png' srcset='/static/1de3a02c5849803d3512998d399ab815/e7570/2022-11-25-6.png 170w,\n/static/1de3a02c5849803d3512998d399ab815/f46e7/2022-11-25-6.png 340w,\n/static/1de3a02c5849803d3512998d399ab815/dbf98/2022-11-25-6.png 612w' sizes='(max-width: 612px) 100vw, 612px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<ul>\n<li>UIì—ì„œ airflow.cfgë¥¼ í™•ì¸í•©ë‹ˆë‹¤</li>\n</ul>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0f4446c8f80891195e7f14d6a90524d8/1745e/2022-11-25-7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 103.52941176470587%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAACq0lEQVR42oVUi3LaMBD0//9c27RpYsC2LFl+ghNcwjtcd68SwzBDysyObKNb7e6dnTy9pGK6Vg67vXx8fMg0TbJer+X9/V32+72Mq1FOp5O8vb3J8XiUaT3J5XKRR79k3G5ls9/KGUUsPJ/PitPpqAQ8hOsW+w6Hg+x2O933CEmRLSTLMqmqStc0TWWxWEie51rMX1R0uz5CMgyD1HUtfd/LcrlUYu+9tG2r9qmMKjebja7/gxKymKRcu667omma6zNmSIzj+CWS1Wql6kjMa668j4RUy7XDMxLGhj1C0g+99CgeUEAiyr58fmqT2JzPa5NOev1VQ7QpaTmXmSnEwXIJNRUsehArcFB9B6qgykdIrC9lbuZiKyfOGDHodIEum/lcDO4tDnKwzMN4zViY1QqIud4isbWXzJYoqCQvrWQktVa7zdw6ZoruR7R4RlAtyaeQKck0Q992YnA6YRvYDoqoRi0jgjYQNzdk3NOHZ/wvNivJnJPnLJfUlPJaGJlD3QtUpgBtGiglecH5BDlVkuCqPKxLqFXLvnFiXC4FYJwRX8L+IhMHcirxQWEVyKLl/k4x9+kclh65lbnktpBFiW5DSQGVzJEKqcyEhrCYStQ+57TrtTlT6LBarttKqtpibEoMcSUtsmlQMAQ7LI6KYmOGAF6TMDYldLmVH7O5/ITNnxiZDIpy4Bs+Et+BGSL4jYyf8f8vjFMfDogR3JKpQgd1mYVlbM5AUOErUzFHX6vVCooJF7ofZ5DW72fxH2GDOXQWM1hqbsyvQjEVMHRmpyOEe9pkXhG3b0hUmnBUnvBWqMXZTG1zdF6LQl6gNiINb02cQR5A2HD4AMVBIWfMSe7YGC8lMwwdjq9bLF7d2g1YBozRctfDkjcK31hpQVIDlP8HH9jpztZXYM1fPVoncqi9rWEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2022 11 25 7' title='2022 11 25 7' src='/static/0f4446c8f80891195e7f14d6a90524d8/ca1dc/2022-11-25-7.png' srcset='/static/0f4446c8f80891195e7f14d6a90524d8/e7570/2022-11-25-7.png 170w,\n/static/0f4446c8f80891195e7f14d6a90524d8/f46e7/2022-11-25-7.png 340w,\n/static/0f4446c8f80891195e7f14d6a90524d8/ca1dc/2022-11-25-7.png 680w,\n/static/0f4446c8f80891195e7f14d6a90524d8/1745e/2022-11-25-7.png 814w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>Summary</h2>\n<ul>\n<li>\n<p>MWAAì˜ ì„¸íŒ… ê´€ë ¨ ì°¸ê³ í• ë§Œí•œ ìë£Œì…ë‹ˆë‹¤.</p>\n<ul>\n<li><a href=\"https://catalog.workshops.aws/amazon-mwaa-for-analytics/en-US\">https://catalog.workshops.aws/amazon-mwaa-for-analytics/en-US</a></li>\n<li><a href=\"https://catalog.workshops.aws/aws-data-ingestion-pipeline/ko-KR\">https://catalog.workshops.aws/aws-data-ingestion-pipeline/ko-KR</a></li>\n</ul>\n</li>\n<li>xcom_backendì˜ ê°’ìœ¼ë¡œ <strong>ì°¸ì¡° ê°€ëŠ¥í•œ ê²½ë¡œì— íŒŒì¼ì´ ìˆì–´ì•¼ë§Œ</strong> í´ëŸ¬ìŠ¤í„° ì •ìƒ ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>\n<li>airflow.cfg ê°’ì„ í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼í•˜ì—¬ ì§ì ‘ì ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ì—†ìŠµë‹ˆë‹¤.</li>\n<li>MWAAëŠ” Managed serviceì´ê¸° ë•Œë¬¸ì—, ìœ„ì— ì„¤ëª…ë“œë¦° ë°©ë²•ìœ¼ë¡œ ìš°íšŒí•˜ì—¬ êµ¬ì¡° ë“±ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>\n<li>\n<p>í˜„ì¬ MWAAì—ì„œëŠ” ë§Œì•½ <code class=\"language-text\">ì˜ëª»ëœ ì„¸íŒ…ê°’</code>ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ ì—…ë°ì´íŠ¸ ì‹œí‚¤ë©´, ë‚´ë¶€ ìš”ì¸ì— ì˜í•´ ì¥ì‹œê°„ í´ëŸ¬ìŠ¤í„°pending ìƒíƒœê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ëŒ€ë¹„í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>\n<ul>\n<li>aws-mwaa-local-runnerë¡œ ë¯¸ë¦¬ êµ¬ì„±ì„ í™•ì¸í•©ë‹ˆë‹¤.</li>\n<li>Network or Permission ë¬¸ì œì¼ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— <a href=\"https://github.com/awslabs/aws-support-tools/tree/master/MWAA\">ë§í¬ì™€</a> ê°™ì€ ë„êµ¬ë¥¼\nì´ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œ ë“œë¦½ë‹ˆë‹¤.</li>\n<li>MWAA <code class=\"language-text\">23ë…„ ë§ˆì¼ìŠ¤í†¤</code>ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„° ì—…ë°ì´íŠ¸ êµ¬ì„± ì§€ì—° ì´ìŠˆëŠ” í•´ê²°ë  ì˜ˆì •ì…ë‹ˆë‹¤.</li>\n</ul>\n</li>\n</ul>\n<h2>References</h2>\n<ul>\n<li><a href=\"https://programmaticponderings.com/2020/12/29/amazon-managed-workflows-for-apache-airflow-configuration-understanding-amazon-mwaas-configuration-options/\">https://programmaticponderings.com/2020/12/29/amazon-managed-workflows-for-apache-airflow-configuration-understanding-amazon-mwaas-configuration-options/</a></li>\n<li><a href=\"https://airflow.apache.org/docs/apache-airflow/2.2.2/configurations-ref.html\">https://airflow.apache.org/docs/apache-airflow/2.2.2/configurations-ref.html</a></li>\n<li><a href=\"https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-env-variables.html#configuring-env-variables-airflow-ref\">https://docs.aws.amazon.com/mwaa/latest/userguide/configuring-env-variables.html#configuring-env-variables-airflow-ref</a></li>\n<li><a href=\"https://docs.astronomer.io/learn/custom-xcom-backends\">https://docs.astronomer.io/learn/custom-xcom-backends</a></li>\n<li><a href=\"https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html\">https://docs.aws.amazon.com/mwaa/latest/userguide/what-is-mwaa.html</a></li>\n</ul>","frontmatter":{"title":"AWS MWAA xcom backend configuration ì´ìŠˆ í•´ê²°","date":"November 25, 2022","update":"November 25, 2022","tags":["AWS","MWAA","Airflow"],"series":null},"fields":{"slug":"/mwaa-xcom-backend-config-issue/","readingTime":{"minutes":5.115}}},"seriesList":{"edges":[{"node":{"id":"4c1ab40d-5821-5c2b-aff0-eb6e84d6617b","fields":{"slug":"/mwaa-xcom-backend-config-issue/"},"frontmatter":{"title":"AWS MWAA xcom backend configuration ì´ìŠˆ í•´ê²°"}}}]},"previous":{"fields":{"slug":"/writing-guide-kr/"},"frontmatter":{"title":"ğŸ¤” 3. ì‘ì„± ê°€ì´ë“œ"}},"next":null},"pageContext":{"id":"4c1ab40d-5821-5c2b-aff0-eb6e84d6617b","series":null,"previousPostId":"002b904d-3b1b-59bf-82a6-2d66e226dcca","nextPostId":null}},"staticQueryHashes":[]}